# TCP/IP结构中每层的协议

应用层：HTTP、FTP、SMTP、TELNET、SSH；DNS、TFTP、SNMP

传输层：TCP、UDP

网络层：IP、ICMP、ARP、RARP、OSPF、BGP

数据链路层：

物理层：

# 应用层

## 应用层有哪些协议：

基于传输层TCP：HTTP FTP SMTP TELNET SSH 

基于传输层UDP：DNS TFTP SNMP

## HTTP

### HTTP的特点：

设计简单、无状态(请求之间是独立)、扩展性强(支持多种格式JSON、HTML)、可以缓存

### HTTP请求和响应

##### 请求方法：POST 、GET、DELETE、PUT、OPTIONS、TRACE

请求体：请求行(请求方法、URL、协议版本)、请求头、请求体

响应体：状态行、响应头、响应体

##### POST和GET的区别

1、规范：get请求一般用来查询数据；post请求一般用来向服务端提交数据

2、参数位置不同：get请求参数在url中；post请求参数在以键值对形式存储请求体中

3、TCP：get请求产生一个TCP数据包；post请求产生两个TCP数据包（第一次确认服务器是否支持post请求，如果支持则传递请求体产生第二个数据包）

4、数据类型：get只能传递ASCII字符；post可以传递JSON、表单等

5、缓存：get请求会被缓存，加快页面加载速度；post不能被缓存

### HTTP状态码

1XX 消息状态码

2XX 请求成功状态码

3XX 重定向状态码

4XX 客户端错误状态码

5XX 服务端错误状态码



### 混合加密：

通过非对称加密保证对称加密密钥传递的私密性，通信双方再利用对称加密密钥通信

非对称加密：公钥加密的数据必须用对应的私钥才能解密；如果用私钥进行加密也必须使用对应的公钥才能解密，否则将无法成功解密

##### 流程：

客户端发送请求 --> 服务端 

服务端发送公钥 --> 客户端 

客户端生成对称密钥(随机字符串Key)并用公钥加密 --> 服务端

客户端<---对称密钥--->服务端

### HTTP和HTTPS的区别

1、HTTP是明文传输，HTTPS是加密传输

原理：HTTPS在HTTP基础上加入了SSL(安全套接层)和TLS(传输层安全)协议。使用HTTPS采用混合加密，客户端向服务端HTTPS请求后，服务端向客户端发送公钥，服务端保有私钥，客户端与服务端之间采用私密传输的对称密钥通信。

2、HTTP端口60，HTTPS端口为443

3、HTTP基于TCP协议；HTTPS基于SSL协议，SSL协议基于TCP协议

4、HTTPS需要服务端申请数字证书

### HTTP和HTTPS建立连接过程

HTTP与HTTPS协议的连接过程都是通过TCP三次握手建立的。

但HTTPS是基于安全套接层协议SSL或者传输安全层TLS的，因此在TCP连接基础上还要进行SSL/TLS握手

##### HTTPS建立连接流程：

客户端发送请求 ----> 服务端 

客户端 <----  服务端发送携带公钥的证书 

客户端检查证书有效性。若有效，客户端用公钥加密生成的对称密钥(随机字符串Key)并发送 ----> 服务端 

 成功建立连接 <------> 服务端通过私钥解密对称密钥Key

客户端 <---对称密钥---> 服务端

### 

### Cookie与Session

作用：由于HTTP协议是无状态协议，请求之间是独立。因此需要借助机制来记录请求之间的关系（例如：用户身份），Cookie与Session是两种会话跟踪技术，可以记录请求间的关系。

原理：Cookie：客户端第一次访问服务器时，服务端将Cookie信息发送给客户端并存储客户端本地。客户端再次发送请求时，将本地Cookie信息发送给服务端，服务端就可以判断用户身份。Session：客户端第一次访问服务器时，服务端将SessionID发送给客户端并保存在客户端本地，而用户信息相关内容则保存在服务端，客户端发送请求时将SessionID发送给服务端，服务端通过SessionID获取用户身份。

区别：

1、Cookie存储在客户端，客户端可以进行操作；Session存储在服务端，客户端无法进行操作

2、Cookie有容量限制；Session容量较大

3、Cookie生命周期较长；Session生命周期较短

3、Cookie传输过程为明文传输，不安全；Session为加密传输，相对安全

## DNS解析

方法：

1、递归查询 

检查操作系统缓存 —> 请求本地域名服务器 —> 请求根域名服务器 —> 顶级域名服务器 —> 权限域名服务器 —> 原路返回(本地域名服务器和操作系统将查询到的IP缓存起来)

2、迭代查询

## 用户在浏览器中输入URL并返回页面的过程

1、输入URL后，首先通过DNS解析域名，找到服务端IP （解析域名）

2、通过IP与服务端进行三次握手建立TCP连接 （建立连接）

3、浏览器向服务器端发起HTTP请求 （发送请求）

4、服务端接收客户端浏览器的请求后，根据请求方法和参数进行业务处理并将数据通过HTTP协议返回给客户端 （返回响应）

5、客户端与服务端之间交互结束，进行四次挥手断开TCP连接 （断开连接）

6、客户端接收到响应数据，解析渲染成页面 （渲染页面）

# 运输层

## TCP与UDP

### TCP与UDP的区别

1、TCP面向连接，UDP面向无连接

2、TCP可靠传输，UDP不可靠传输

3、TCP面向字节流传输，UDP面向报文

4、TCP通信是点到点的，UDP通信可以是多对多的

5、TCP实时性差，UDP可以保证实时性（TCP有拥塞窗口机制，网络性能差情况下会限制发送速率）

6、TCP首部开销大，UDP首部开销小 （因为TCP存在多个字段来保证可靠传输：序号、确认号、标志位、窗口大小等）



### TCP首部主要组成

源端口号、目的端口号、序号、确认号、标志位、滑动窗口大小、校验和



### TCP如何实现可靠传输

1、序号和确认号机制：可以确定发送的数据包的状态，通过序号保证数据包顺序、确认号保证数据包接收。（三次握手和四次挥手就是依赖序号和确认号的）

2、流量控制机制：接收方接收数据后根据滑动窗口机制限制发送方的发送速率，保证数据不会因超出接收缓存大小而丢失

3、拥塞控制机制：根据网络拥塞状况限制发送方的发送速率



### TCP的拥塞控制机制

慢开始：设置拥塞窗口cwnd为最大报文段MSS，每经过一个传输轮次cwnd就加倍，直到达到ssthresh慢开始门限

拥塞避免：当cwnd超过慢开始门限时，每经过一个传输轮次cwnd就加1。当发送方未收到确认判断为网络拥塞，则将cwnd置为1并执行慢开始算法，慢开始门限设为拥塞时窗口的一半。（传输轮次：将cwnd允许的报文段发送并完整接收的时间，一个轮次的时间是RTT）

快重传：接收方收到失序的报文后立即发出重复确认，当发送方收到三个重复确认后立即重传丢失报文段。

快恢复：将慢开始门限和cwnd都设为拥塞时窗口的一半，并开始执行拥塞避免算法。（为避免非网络拥塞而导致的个别报文段丢失使发送端错误地执行慢开始（降低传输效率）。）

### 基于TCP与UDP的应用层协议

TCP：HTTP、FTP、SMTP、TELNET、SSh

UDP：DNS、TFTP、SNMP



# 网络层

## IP协议



## ARP（地址解析协议）

### 作用：

得知目标设备物理MAC地址是通信的基础，ARP协议可以将IP地址转换为MAC地址。

### 作用范围：

ARP消息以广播形式发送，因此只能在本地局域网内。超出局域网则需要依赖路由协议。

### 原理：当主机A希望与主机B通信时，一般情况下A只知道B的IP地址，但A需要知道B的物理地址才能通信。

首先，A设备在发送ARP请求之前先查看ARP缓存中是否存在目的IP地址与MAC地址的映射，若存在则直接通信。

若不存在，则以广播的形式向局域网内发送ARP请求消息，当主机B收到ARP请求消息后，将MAC地址返回给主机A。

主机A接收到ARP响应消息后，利用主机B的MAC地址进行通信并将该IP与MAC地址的映射保存至ARP缓存。



## ICMP（互联网控制报文协议）

ICMP是IP协议的扩展协议，在IP网络内传递诊断和控制信息

### 作用

提供网络诊断方面功能

### ping

ping（Packet Internet Groper）因特网包探索器，可用于测试网络连接的程序。

